generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String    @id @default(uuid())
  email          String    @unique
  passwordHash   String?   @default("")
  fullName       String
  profilePicture String?
  role           String    @default("TEACHER")
  campusId       String?
  department     String?
  status         String    @default("Active")
  lastActive     DateTime?
  lastSeen       DateTime?
  isVerified     Boolean   @default(false)
  campusAccess   String?
  dateOfBirth    String?
  managerId      String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  sentObservations     Observation[]             @relation("Observer")
  receivedObservations Observation[]             @relation("Teacher")
  proposedEvents       TrainingEvent[]           @relation("ProposedEvents")
  goals                Goal[]
  registrations        Registration[]
  pdHours              PDHour[]
  createdDocuments     Document[]
  acknowledgements     DocumentAcknowledgement[]
  moocSubmissions      MoocSubmission[]
}

model Observation {
  id                 String              @id @default(uuid())
  teacherId          String
  observerId         String
  date               String
  domain             String
  score              Float
  notes              String?
  status             String              @default("SUBMITTED")
  actionStep         String?
  teacherReflection  String?
  detailedReflection String?
  discussionMet      Boolean             @default(false)
  hasReflection      Boolean             @default(false)
  campus             String?
  block              String?
  grade              String?
  section            String?
  learningArea       String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  // Relations
  teacher       User                @relation("Teacher", fields: [teacherId], references: [id])
  observer      User                @relation("Observer", fields: [observerId], references: [id])
  domainRatings ObservationDomain[]
}

model ObservationDomain {
  id            String      @id @default(uuid())
  observationId String
  domainId      String
  title         String
  rating        String
  evidence      String?

  observation Observation @relation(fields: [observationId], references: [id], onDelete: Cascade)
}

model Goal {
  id              String   @id @default(uuid())
  teacherId       String
  title           String
  description     String?
  progress        Int      @default(0)
  dueDate         String
  status          String   @default("IN_PROGRESS")
  isSchoolAligned Boolean  @default(false)
  category        String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  teacher User @relation(fields: [teacherId], references: [id])
}

model TrainingEvent {
  id           String         @id @default(uuid())
  title        String
  topic        String
  type         String
  date         String
  location     String
  capacity     Int
  status       String         @default("PLANNED")
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  registrations Registration[]
  proposedById String?
  proposedBy   User?          @relation("ProposedEvents", fields: [proposedById], references: [id])
}

model Registration {
  id               String   @id @default(uuid())
  eventId          String
  userId           String
  registrationDate DateTime @default(now())

  event TrainingEvent @relation(fields: [eventId], references: [id])
  user  User          @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
}

model PDHour {
  id       String   @id @default(uuid())
  userId   String
  activity String
  hours    Float
  category String
  status   String   @default("APPROVED")
  date     DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

model MoocSubmission {
  id                  String   @id @default(uuid())
  userId              String
  courseName          String
  platform            String
  otherPlatform       String?
  hours               Float
  startDate           DateTime
  endDate             DateTime
  hasCertificate      String
  certificateType     String?
  proofLink           String?
  certificateFile     String?
  certificateFileName String?
  keyTakeaways        String?
  unansweredQuestions String?
  enjoyedMost         String?
  effectivenessRating Int
  additionalFeedback  String?
  teacherName         String?
  teacherEmail        String?
  status              String   @default("PENDING")
  submittedAt         DateTime @default(now())
  updatedAt           DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model Document {
  id                String   @id @default(uuid())
  title             String
  description       String?
  fileUrl           String
  fileName          String
  fileSize          Int?
  version           String   @default("1.0")
  requiresSignature Boolean  @default(false)
  createdById       String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  hash              String?

  createdBy        User                      @relation(fields: [createdById], references: [id])
  acknowledgements DocumentAcknowledgement[]
}

model DocumentAcknowledgement {
  id             String    @id @default(uuid())
  documentId     String
  teacherId      String
  status         String    @default("PENDING")
  viewedAt       DateTime?
  acknowledgedAt DateTime?
  signatureUrl   String?
  ipAddress      String?
  userAgent      String?
  receiptUrl     String?
  documentHash   String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  document Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  teacher  User     @relation(fields: [teacherId], references: [id])
}

model Chat {
  id String @id @default(uuid())
}

model ChatParticipant {
  id String @id @default(uuid())
}

model MeetingRoom {
  id String @id @default(uuid())
}

model Message {
  id String @id @default(uuid())
}

model Project {
  id String @id @default(uuid())
}

model Task {
  id String @id @default(uuid())
}

model ProjectMembers {
  A String
  B String

  @@unique([A, B])
  @@map("_ProjectMembers")
}

model TaskAssignees {
  A String
  B String

  @@unique([A, B])
  @@map("_TaskAssignees")
}
