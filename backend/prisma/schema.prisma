// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
<<<<<<< HEAD
  provider = "sqlite"
  url      = env("DATABASE_URL")
}








=======
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  LEADER
  TEACHER
  MANAGEMENT
  SUPERADMIN
  MANAGER
  TEAM_MEMBER
  CUSTOMER
}

enum ObservationStatus {
  DRAFT
  SUBMITTED
  REVIEWED
}

enum GoalStatus {
  IN_PROGRESS
  NEAR_COMPLETION
  COMPLETED
  ON_HOLD
}

enum TrainingStatus {
  PLANNED
  ONGOING
  COMPLETED
  CANCELLED
}
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String?   @default("") // Renamed to match existing DB
  fullName      String
  profilePicture String?   // Renamed to match existing DB
<<<<<<< HEAD
  role          String      @default("TEACHER")
=======
  role          Role      @default(TEACHER)
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  campusId      String?
  department    String?
  status        String    @default("Active")
  lastActive    DateTime?
  lastSeen      DateTime? // Added to match existing DB
  isVerified    Boolean   @default(false) // Added to match existing DB
  campusAccess  String?   // Added to match existing DB
  dateOfBirth   String?   // Added to match existing DB
  managerId     String?   // Added to match existing DB
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  sentObservations     Observation[] @relation("Observer")
  receivedObservations Observation[] @relation("Teacher")
<<<<<<< HEAD
  proposedEvents       TrainingEvent[] @relation("ProposedEvents")
=======
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  goals                Goal[]
  registrations        Registration[]
  pdHours              PDHour[]
  createdDocuments     Document[]
  acknowledgements     DocumentAcknowledgement[]
<<<<<<< HEAD
  moocSubmissions      MoocSubmission[]
=======
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
}

model Observation {
  id                String            @id @default(uuid())
  teacherId         String
  observerId        String
  date              String            // Or DateTime
  domain            String
  score             Float
<<<<<<< HEAD
  notes             String?           
  status            String            @default("SUBMITTED")
  actionStep        String?           
  teacherReflection String?           
  detailedReflection String?             
  discussionMet     Boolean           @default(false)
  hasReflection     Boolean           @default(false)
  campus            String?
  block             String?
  grade             String?
  section           String?
  learningArea      String?
=======
  notes             String?           @db.Text
  status            ObservationStatus @default(SUBMITTED)
  actionStep        String?           @db.Text
  teacherReflection String?           @db.Text
  detailedReflection Json?             @db.JsonB
  discussionMet     Boolean           @default(false)
  hasReflection     Boolean           @default(false)
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relations
  teacher           User              @relation("Teacher", fields: [teacherId], references: [id])
  observer          User              @relation("Observer", fields: [observerId], references: [id])
  domainRatings     ObservationDomain[]
}

model ObservationDomain {
  id             String      @id @default(uuid())
  observationId  String
<<<<<<< HEAD
  domainId       String
  title          String
  rating         String
  evidence       String?     
=======
  domainId       Int
  title          String
  rating         String
  evidence       String?     @db.Text
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  
  observation    Observation @relation(fields: [observationId], references: [id], onDelete: Cascade)
}

model Goal {
  id                String     @id @default(uuid())
  teacherId         String
  title             String
<<<<<<< HEAD
  description       String?    
  progress          Int        @default(0)
  dueDate           String
  status            String     @default("IN_PROGRESS")
=======
  description       String?    @db.Text
  progress          Int        @default(0)
  dueDate           String
  status            GoalStatus @default(IN_PROGRESS)
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  isSchoolAligned   Boolean    @default(false)
  category          String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  teacher           User       @relation(fields: [teacherId], references: [id])
}

model TrainingEvent {
  id            String         @id @default(uuid())
  title         String
  topic         String
  type          String
  date          String
  location      String
  capacity      Int
<<<<<<< HEAD
  status        String         @default("PLANNED")
=======
  status        TrainingStatus @default(PLANNED)
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  registrations Registration[]
<<<<<<< HEAD
  proposedById  String?
  proposedBy    User?          @relation("ProposedEvents", fields: [proposedById], references: [id])
=======
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
}

model Registration {
  id               String   @id @default(uuid())
  eventId          String
  userId           String
  registrationDate DateTime @default(now())

  event            TrainingEvent @relation(fields: [eventId], references: [id])
  user             User          @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
}

model PDHour {
  id          String   @id @default(uuid())
  userId      String
  activity    String
  hours       Float
  category    String
  status      String   @default("APPROVED")
  date        DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id])
}

<<<<<<< HEAD
model MoocSubmission {
  id                  String   @id @default(uuid())
  userId              String
  courseName          String
  platform            String
  otherPlatform       String?
  hours               Float
  startDate           DateTime
  endDate             DateTime
  hasCertificate      String   // "yes" or "no"
  certificateType     String?  // "link" or "file"
  proofLink           String?
  certificateFile     String?  // Base64 or path
  certificateFileName String?
  keyTakeaways        String?
  unansweredQuestions String?
  enjoyedMost         String?
  effectivenessRating Int
  additionalFeedback  String?
  teacherName         String?
  teacherEmail        String?
  status              String   @default("PENDING") // PENDING, APPROVED, REJECTED
  submittedAt         DateTime @default(now())
  updatedAt           DateTime @updatedAt

  user                User     @relation(fields: [userId], references: [id])
}



model Document {
  id                String   @id @default(uuid())
  title             String
  description       String?  
=======
enum AcknowledgementStatus {
  PENDING
  VIEWED
  ACKNOWLEDGED
  SIGNED
}

model Document {
  id                String   @id @default(uuid())
  title             String
  description       String?  @db.Text
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  fileUrl           String
  fileName          String
  fileSize          Int?
  version           String   @default("1.0")
  requiresSignature Boolean  @default(false)
  createdById       String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  hash              String?  // SHA256 hash of file

  createdBy         User                     @relation(fields: [createdById], references: [id])
  acknowledgements  DocumentAcknowledgement[]
}

model DocumentAcknowledgement {
  id              String                @id @default(uuid())
  documentId      String
  teacherId       String
<<<<<<< HEAD
  status          String                @default("PENDING")
=======
  status          AcknowledgementStatus @default(PENDING)
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  viewedAt        DateTime?
  acknowledgedAt  DateTime?
  signatureUrl    String?
  ipAddress       String?
<<<<<<< HEAD
  userAgent       String?              
=======
  userAgent       String?              @db.Text
>>>>>>> 6a9198745ad4aeaac08f094cc2d989de31863c9a
  receiptUrl      String?
  documentHash    String?              // SHA256 at time of acknowledgement
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  document        Document             @relation(fields: [documentId], references: [id], onDelete: Cascade)
  teacher         User                 @relation(fields: [teacherId], references: [id])

}

// Placeholder models to prevent Prisma from dropping existing tables
model Chat {
  id String @id @default(uuid())
}

model ChatParticipant {
  id String @id @default(uuid())
}

model MeetingRoom {
  id String @id @default(uuid())
}

model Message {
  id String @id @default(uuid())
}

model Project {
  id String @id @default(uuid())
}

model Task {
  id String @id @default(uuid())
}

model ProjectMembers {
  A String
  B String
  @@unique([A, B])
  @@map("_ProjectMembers")
}

model TaskAssignees {
  A String
  B String
  @@unique([A, B])
  @@map("_TaskAssignees")
}
